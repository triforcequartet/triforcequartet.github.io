---
const { pathname } = Astro.url;
---

<header>
  {pathname === "/" ? (
    <h1 class="nav-title">
      <a href="/">
        <img src="/img/tq.svg" class="nav-logo" />
        <span>Triforce<br />Quartet</span>
      </a>
    </h1>
  ) : (
    <p class="nav-title">
      <a href="/">
        <img src="/img/tq.svg" class="nav-logo" />
        <span>Triforce<br />Quartet</span>
      </a>
    </p>
  )}
  <nav>
    <ul class="navbar-links">
        {pathname === "/" ? (
          <li><a href="#music">Music</a></li>
          <li><a href="#events">Events</a></li>
          <li><a href="#about">About</a></li>
        ) : (
          <li><a href="/#music">Music</a></li>
          <li><a href="/#events">Events</a></li>
          <li><a href="/#about">About</a></li>
        )}
        <li id="services-menu">
          <button aria-haspopup="true"
            aria-expanded="false"
            aria-controls="services-list"
            id="services-button">
            Services <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="000"><path d="M480-344 240-584l56-56 184 184 184-184 56 56-240 240Z"/></svg>
          </button>
          <ul aria-hidden="true" id="services-list">
            <li><a href="/conventions">Conventions</a></li>
            <li><a href="/weddings">Weddings</a></li>
            <li><a href="/schools">Schools</a></li>
            <li><a href="/corporates">Corporate</a></li>
            <li><a href="/other-services">Other Events</a></li>
          </ul>
        </li>
        <li><button class="cta" id="book-button" data-contact-dialog>Book</button></li>
        <li>    
          <button id="hamburger">
              <svg aria-label="Menu" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                  <rect y="1" width="12" height="2" />
                  <rect y="5" width="12" height="2" />
                  <rect y="9" width="12" height="2" />
              </svg>
          </button>
        </li>
    </ul>
    <dialog id="mobile-nav">
      <button id="mobile-nav-close">
        <svg aria-label="Close menu" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
          <rect x="1.05029" y="9.53554" width="12" height="2" transform="rotate(-45 1.05029 9.53554)" />
          <rect x="2.46436" y="1.05025" width="12" height="2" transform="rotate(45 2.46436 1.05025)" />
        </svg>
      </button>
        <ul class="mobile-nav-links">
          {pathname === "/" ? (
            <li><a href="#music">Music</a></li>
            <li><a href="#events">Events</a></li>
            <li><a href="#about">About</a></li>
          ) : (
            <li><a href="/#music">Music</a></li>
            <li><a href="/#events">Events</a></li>
            <li><a href="/#about">About</a></li>
          )}
          <li>
              <p>Services</p>
              <ul>
                <li><a href="/conventions">Conventions</a></li>
                <li><a href="/weddings">Weddings</a></li>
                <li><a href="/schools">Schools</a></li>
                <li><a href="/corporates">Corporate</a></li>
                <li><a href="/other-services">Other Events</a></li>
              </ul>
          </li>
        </ul>
    </dialog>
  </nav>
</header>

<script>
  const hamburger = document.getElementById('hamburger') as HTMLButtonElement;
  const mobileNavClose = document.getElementById('mobile-nav-close');
  const mobileNav = document.getElementById('mobile-nav') as HTMLDialogElement;
const mobileNavLinks = document.querySelectorAll('.mobile-nav-links a');

mobileNavLinks.forEach(link => {
  link.addEventListener('click', event => {
    const href = link.getAttribute('href');
    if (!href) return; // stop if there's no href

    // Only handle internal anchor links like "#music"
    if (href.startsWith('#') && href.length > 1) {
      // event.preventDefault(); // stop the browser from jumping immediately

      const targetId = href.slice(1);
      const targetSection = document.getElementById(targetId);
      const heading = targetSection?.querySelector('h2');

      mobileNav.close();

      // Let the dialog finish closing before jumping/focusing
        if (heading) {
          heading.focus({ preventScroll: true }); // focus without moving
          // heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
  });
});
  
  hamburger.addEventListener("click", () => {
    mobileNav.showModal();
  });
  mobileNavClose?.addEventListener("click", () => {
    mobileNav.close();
  });

  const mediaQuery = window.matchMedia('(min-width: 768px)');
  mediaQuery.addEventListener('change', (e) => {
    if (e.matches && mobileNav.open) {
      mobileNav.close();
      document.getElementById('book-button')?.focus();
    }
  });

  const servicesButton = document.getElementById('services-button') as HTMLButtonElement;
  const servicesMenu = document.getElementById('services-list') as HTMLUListElement;

  servicesButton.addEventListener('click', () => {
    const expanded = servicesButton.getAttribute('aria-expanded') === 'true';

    // Toggle expanded state
    servicesButton.setAttribute('aria-expanded', String(!expanded));

    // Toggle menu visibility
    servicesMenu.setAttribute('aria-hidden', String(expanded));
  });

</script>